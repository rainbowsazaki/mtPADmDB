<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<title>タイトル</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">

</head>

<body>

<div id="app">
  <div class="container">
    <div style="position:fixed; z-index: 2;">
      <div v-for="error in errors" class="alert alert-warning alert-dismissible fade show" role="alert">
        <strong>注意!</strong>　{{error}}
        <button type="button" @click="$store.commit('deleteError', error)" class="close" aria-label="閉じる">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div v-for="message in messages" class="alert alert-success alert-dismissible fade show" role="alert">
        {{message}}
      </div>
    </div>
    
    <h1>みんなで作るパズドラモンスターデータベース</h1>
    <nav aria-label="パンくずリスト">
      <ol class="breadcrumb">
        <li v-for="breadcrumb in breadcrumbs" :aria-current="breadcrumb.link ? '' : 'page '" class="breadcrumb-item" :class="{ active: !breadcrumb.link }">
          <router-link v-if="breadcrumb.link" :to="breadcrumb.link" >{{breadcrumb.text}}</router-link>
          <template v-else>{{breadcrumb.text}}</template>
        </li>
      </ol>
    </nav>
    <router-view></router-view>
  </div>
</div>


<script type="text/x-template" id="templateMonsterList">
  <div>
    <table class="table">
      <thead class="thead-light">
        <tr>
          <th>#</th>
          <th>名前</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="(data, key) in monsterTable">
          <td>{{key}}</td>
          <td><router-link :to="'/' + key">{{data.name}}</router-link></td>
          <td><router-link :to="'/edit/' + key">編集</router-link></td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td><router-link to="/edit/">追加</router-link></td>
        </tr>
      </tbody>
    </table>
  </div>
</script>


<script type="text/x-template" id="templateMonsterData">
  <div>
    <div class="row">
      <div class="col-12">
        <h2>No. {{monsterData.no}} {{monsterData.name}}</h2>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <img :src="`./monsterImages/${monsterData.no}.jpg`" style="width: 320px; height: auto; display: block; margin: 0 auto;" onerror="var p = './monsterImages/notFound.jpg'; if (this.src!=p) { this.src = p; }" />
        <table class="table table-bordered table-sm">
          <tr class="thead-light">
            <th colspan="2">タイプ</th><th>属性</th>
          </tr>
          <tr>
            <td colspan="2"><span v-for="type in monsterData.types" v-if="type !== 0">{{typeTable[type]}} </span></td>
            <td><span v-for="attr in monsterData.attributes" v-if="attr !== 0">{{attributeTable[attr]}} </span></td>
          </tr>
          <tr class="thead-light">
            <th>コスト</th><th>レア</th><th>アシスト</th>
          </tr>
          <tr>
            <td>{{monsterData.cost}}</td>
            <td>{{monsterData.rare}}</td>
            <td>{{booleanTable[monsterData.assist]}}</td>
          </tr>
          
          <tr class="thead-light">
            <th>最大レベル</th><th>必要経験値</th><th>限界突破</th>
          </tr>
          <tr>
            <td>{{monsterData.maxLevel}}</td>
            <td>{{monsterData.expTable}}</td>
            <td>{{booleanTable[monsterData.overLimit]}}</td>
          </tr>
          <tr class="thead-light"><th colspan="3">覚醒</th></tr>
          <tr><td colspan="3">
            <ul style="list-style: none; padding: 0px; display: flex;">
                <li v-for="awaken in monsterData.awakens" v-if="awaken !== 0" ><img :src="'./kakusei/' + awaken + '.png'" width="24" height="24" :title="awakenTable[awaken]"></li>
              </ul>
          </td></tr>
        </table>
      </div>
      <div class="col-md-6">
        <table class="table table-bordered table-sm">
          <tr class="thead-light"><th colspan="2">レベル{{monsterData.maxLevel}}（最大）時</th><th>+297</th></tr></td>
          <tr><th>HP</th><td>{{monsterData.maxParam.hp}}</td><td>{{monsterData.maxParam.hp + 10 * 99}}</td></tr>
          <tr><th>攻撃</th><td>{{monsterData.maxParam.attack}}</td><td>{{monsterData.maxParam.attack + 5 * 99}}</td></tr>
          <tr><th>回復</th><td>{{monsterData.maxParam.recovery}}</td><td>{{monsterData.maxParam.recovery + 3 * 99}}</td></tr>
          <tr v-if="monsterData.overLimit == 1" class="thead-light"><th colspan="2">レベル110（限界突破）時</th><th>+297</th></tr></td>
          <tr v-if="monsterData.overLimit == 1"><th>HP</th><td>{{monsterData.overLimitParam.hp}}</td><td>{{monsterData.overLimitParam.hp + 10 * 99}}</td></tr>
          <tr v-if="monsterData.overLimit == 1"><th>攻撃</th><td>{{monsterData.overLimitParam.attack}}</td><td>{{monsterData.overLimitParam.attack + 5 * 99}}</td></tr>
          <tr v-if="monsterData.overLimit == 1"><th>回復</th><td>{{monsterData.overLimitParam.recovery}}</td><td>{{monsterData.overLimitParam.recovery + 3 * 99}}</td></tr>
        </table>

        <table class="table table-bordered table-sm">
            <tr class="thead-light"><th>スキル</th></tr>
            <tr><td>
              {{skillName}}
              <span v-if="skillBaseTurn >= 1" style="font-size: 80%; float:right;">(Lv.1 ターン:{{skillBaseTurn}} 最大Lv.{{skillMaxLevel}} ターン:{{skillBaseTurn - skillMaxLevel + 1}})</span>
            </td></tr>
            <tr><td style="font-size: 90%;">{{skillDescription}}</td></tr>
  
            <tr class="thead-light"><th>リーダースキル</th></tr>
            <tr><td>
              {{leaderSkillName}}
            </td></tr>
            <tr><td style="font-size: 90%;">{{leaderSkillDescription}}</td></tr>
          </table> 
      </div>
    </div>

    <div class="row" v-if="monsterData.overLimit == 1 && monsterData.superAwakens.length">
      <div class="col-12">
        <table class="table table-bordered table-sm">
          <tr class="thead-light"><th>超覚醒</th></tr>
          <tr><td>
              <ul>
                <li v-for="superAwaken in monsterData.superAwakens"><img :src="'./kakusei/' + superAwaken + '.png'" width="24" height="24" :title="awakenTable[superAwaken]">{{awakenTable[superAwaken]}}</li>
              </ul>
          </td></tr>
        </table>
      </div>
    </div>
    <div v-if="monsterData.evolution.type !== 0">
      <table class="table table-bordered table-sm">
        <tr class="thead-light"><th>このモンスターへの進化形式</th></tr>
        <tr><td>{{evolutionTypeTable[monsterData.evolution.type]}}</td></tr>
        <tr class="thead-light"><th>進化前モンスター</th></tr>
        <tr><td><router-link :to="`/${monsterData.evolution.baseNo}`">No. {{monsterData.evolution.baseNo}} {{monsterTable[monsterData.evolution.baseNo] && monsterTable[monsterData.evolution.baseNo].name}}</router-link></td></tr>
        <tr class="thead-light"><th>進化素材</th></tr>
        <tr><td>
          <ul style="width: 100%; list-style: none; padding: 0px; display:flex; justify-content: space-around;">
            <li v-for="material in monsterData.evolution.materials" v-if="material !== 0" style="flex: 1;"><router-link :to="`/${material}`">No. {{material}} {{monsterTable[material] && monsterTable[material].name}}</router-link></li>
          </ul>
        </td></tr>
      </table>
    </div>
    <router-link :to="'/edit/' + monsterData.no">編集する</router-link>
  </div>

</script>


<script type="text/x-template" id="templateMonsterEdit">
  <div>
    <form onsubmit="return false;" @submit="submit">

      <div class="form-row">
        <div class="col-md-3">
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text">No.</span>
            </div>
            <input type="number" class="form-control" id="inputNo" v-model="monsterData.no">
          </div>
        </div>
        <div class="form-group col-md-9">
          <input type="text" class="form-control" id="inputMonsterName" placeholder="モンスター名" v-model="monsterData.name">
        </div>
      </div>
      <div>
        <label for="selectType1">タイプ</label>
        <div class="form-row">
          <div class="col-md-4" v-for="n in 3">
            <select class="custom-select" :id="'selectType' + n" v-model="monsterData.types[n - 1]">
              <option v-for="(type, key) in typeTable" :value="key" :key="key" v-once>{{type}}</option>
            </select>
          </div>
        </div>
      </div>
      <div class="form-row">
          <div class="col-md-3">
            <label for="selectType1">属性</label>
            <select class="custom-select" id="selectType1" v-model="monsterData.attributes[0]">
              <option v-for="(attribute, key) in attributeTable" :value="key" :key="key" v-once>{{attribute}}</option>
            </select>
          </div>
          <div class="col-md-3">
            <label for="selectType1">複属性</label>
            <select class="custom-select" id="selectType2" v-model="monsterData.attributes[1]">
              <option v-for="(attribute, key) in attributeTable" :value="key" :key="key" v-once>{{attribute}}</option>
            </select>
          </div>
            
          <div class="col-md-3">
            <label for="selectType1">コスト</label>
            <input type="number" class="form-control" id="inputNo" v-model="monsterData.cost">
          </div>
          <div class="col-md-3">
            <label for="selectType1">レアリティ
            </label>
            <input type="number" class="form-control" id="inputNo" v-model="monsterData.rare">
          </div>
      </div>

      <div>
        <label for="selectType1">覚醒</label>
        <div v-for="n in 9"　class="form-row" :key="n">
          <pd-select v-model="monsterData.awakens[n - 1]">
            <pd-option v-for="(awaken, key) in awakenTable" :value="key" :key="key" v-once><img :src="(key == 0 || key == 99) ? '' : `./kakusei/${key}.png`" width="24" height="24" /> {{awaken}}</pd-option>
          </pd-select>
        </div>
      </div>
      
      <div class="form-row">
          <div class="col-md-4">
            <label for="selectType1">最大レベル</label>
            <input type="number" class="form-control" id="inputNo" v-model="monsterData.maxLevel">
          </div>
      
          <div class="col-md-4">
            <label for="selectType1">最大レベルに必要な経験値</label>
            <input type="number" class="form-control" id="inputNo" v-model="monsterData.expTable">
          </div>
          <div class="col-md-4">
            <label for="selectType1">アシスト</label>
            <select class="custom-select" id="selectAssist" v-model="monsterData.assist">
              <option v-for="(type, key) in booleanTable" :value="key" :key="key" v-once>{{type}}</option>
            </select>
          </div>
      </div>
      
      <div class="form-row">
        レベル最大時
      </div>
      <div class="form-group row">
        <label for="inputEmail" class="col-md-2 col-form-label">HP</label>
        <div class="col-md-4">
          <input type="number" class="form-control" id="inputNo" v-model="monsterData.maxParam.hp">
        </div>
      </div>
      <div class="form-group row">
        <label for="inputEmail" class="col-md-2 col-form-label">攻撃</label>
        <div class="col-md-4">
          <input type="number" class="form-control" id="inputNo" v-model="monsterData.maxParam.attack">
        </div>
      </div>
      <div class="form-group row">
        <label for="inputEmail" class="col-md-2 col-form-label">回復</label>
        <div class="col-md-4">
          <input type="number" class="form-control" id="inputNo" v-model="monsterData.maxParam.recovery">
        </div>
      </div>

      <div class="form-row">
        スキル
      </div>
      <div class="form-row">
        
        <div class="col-md-6">
          <div class="form-group">
            <skill-incremental-input placeholder="スキル名" @select-no="monsterData.skillNo = $event;" v-model="skillName" :skill-table="skillTable"></skill-incremental-input> 
          </div>
        </div>
        <div class="col-md-3">
          <div class="input-group">
            <label for="selectType1"></label>
            <div class="input-group-prepend">
              <span class="input-group-text">SLv1時ターン</span>
            </div>
            <input type="number" class="form-control" id="inputSkillTurn" v-model="skillBaseTurn">
          </div>
        </div>
        <div class="col-md-3">
          <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">最大SLv</span>
              </div>
            <input type="number" class="form-control" id="inputMonsterName" v-model="skillMaxLevel">
          </div>
        </div>
      </div>
      <div class="form-group">
        <textarea class="form-control" id="exampleFormControlTextarea1" rows="2" v-model="skillDescription"></textarea>
      </div>

      <div class="form-group">
        <label for="formReaderSkillName">リーダースキル</label>
        <skill-incremental-input placeholder="リーダースキル名" @select-no="monsterData.leaderSkillNo = $event;" v-model="leaderSkillName" :skill-table="leaderSkillTable"></skill-incremental-input>
        <textarea class="form-control" id="exampleFormControlTextarea1" rows="2" v-model="leaderSkillDescription"></textarea>
      </div>

      <div class="form-group">
        <label for="formOverLimit">限界突破</label>
        <select class="custom-select" id="selectOverLimit" v-model="monsterData.overLimit">
          <option v-for="(type, key) in booleanTable" :value="key" :key="key" v-once>{{type}}</option>
        </select>
      </div>
      <div v-if="monsterData.overLimit == 1" class="form-row">
        限界突破時パラメータ
      </div>
      <div v-if="monsterData.overLimit == 1" class="form-group row">
        <label for="formOverLimitHp" class="col-md-2 col-form-label">HP</label>
        <div class="col-md-4">
          <input type="number" class="form-control" id="formOverLimitHp" v-model="monsterData.overLimitParam.hp">
        </div>
      </div>
      <div v-if="monsterData.overLimit == 1" class="form-group row">
        <label for="formOverLimitAttack" class="col-md-2 col-form-label">攻撃</label>
        <div class="col-md-4">
          <input type="number" class="form-control" id="formOverLimitattack" v-model="monsterData.overLimitParam.attack">
        </div>
      </div>
      <div v-if="monsterData.overLimit == 1" class="form-group row">
        <label for="formOverLimitRecovery" class="col-md-2 col-form-label">回復</label>
        <div class="col-md-4">
          <input type="number" class="form-control" id="formOverLimitRecovery" v-model="monsterData.overLimitParam.recovery">
        </div>
      </div>

      <div v-if="monsterData.overLimit == 1" class="form-group">
        <div class="row"><div class="col">超覚醒</div></div>
        <div class="row">
          <div v-for="(awaken, key) in awakenTable" v-if="key != 0" class="col-md-3 form-check" :key="key">
            <input class="form-check-input" type="checkbox" :value="key" v-model="monsterData.superAwakens" :id="'superAwaken' + key">
            <label class="form-check-label" :for="'superAwaken' + key">
              <img v-if="key != 99" :src="'./kakusei/' + key + '.png'" width="24" height="24" />{{awaken}}
            </label>
          </div>
        </div>
      </div>

      <div class="form-row">
        <label for="">進化形式</label>
      </div>
      <div class="form-row">
        <div class="col-md-4">
          <select class="custom-select" id="evolutionType" v-model="monsterData.evolution.type">
            <option v-for="(type, key) in evolutionTypeTable" :value="key" :key="key" v-once>{{type}}</option>
          </select>
        </div>
      </div>
      <div v-if="monsterData.evolution.type != 0">
        <div class="form-row">
          <label for="">進化前キャラ</label>
        </div>
        <monster-incremental-search v-model="monsterData.evolution.baseNo" :monster-table="monsterTable"></monster-incremental-search>
        <div class="form-row">
          <label for="">素材</label>
        </div>
        <monster-incremental-search v-for="n in 5" v-model="monsterData.evolution.materials[n - 1]" :monster-table="monsterTable" :key="n"></monster-incremental-search>
      </div>
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
  </div>
</script>

<script type="text/x-template" id="templatePic">
  <div>
    <img :src="uploadImgSrc" />
    No.<input type="number" v-model="monsterNo" />
    <div class="upload">
      <input type="file" name="file" id="file" @change="loadLocalImage">
    </div>
    <canvas id="canvas"></canvas>
    <div id="result">
        <img :src="imageResultSrc" />
        <img :src="iconResultSrc" />
    </div>
    <button @click="submit">送信</button>
  </div>
</script>


<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.2.1/vue.js"></script>
<script src="https://cdn.jsdelivr.net/vue.router/2.0.1/vue-router.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://unpkg.com/vuex@3.0.1/dist/vuex.js"></script>

<script src="./script.js"></script>

</body>
</html>