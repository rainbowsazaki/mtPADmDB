<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<title>タイトル</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">

</head>

<body style="padding-top: 4.5rem;">

<div id="app">
  <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top" style="box-shadow: 0px 0px 4px rgba(0,0,0,0.6);">
    <router-link class="navbar-brand" to="/">mtPADmDB</router-link>
    <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="ナビゲーションの切替">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li v-for="navi in navis" class="nav-item">
          <router-link class="nav-link" :class="{ active: $route.path === navi.to }" :to="navi.to">{{navi.text}}</router-link>
        </li>
      </ul>
    </div>
  </nav>
  
  <div class="container">
    <div style="position:fixed; z-index: 2;">
      <div v-for="error in errors" class="alert alert-warning alert-dismissible fade show" role="alert">
        <strong>注意!</strong>　{{error}}
        <button type="button" @click="$store.commit('deleteError', error)" class="close" aria-label="閉じる">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div v-for="message in messages" class="alert alert-success alert-dismissible fade show" role="alert">
        {{message}}
      </div>
    </div>
    
    <h1>みんなで作るパズドラモンスターデータベース</h1>
    <nav aria-label="パンくずリスト">
      <ol class="breadcrumb">
        <li v-for="breadcrumb in breadcrumbs" :aria-current="breadcrumb.link ? '' : 'page '" class="breadcrumb-item" :class="{ active: !breadcrumb.link }">
          <router-link v-if="breadcrumb.link" :to="breadcrumb.link" >{{breadcrumb.text}}</router-link>
          <template v-else>{{breadcrumb.text}}</template>
        </li>
      </ol>
    </nav>
    <router-view></router-view>
  </div>
</div>

<!-- これは何？ページ -->
<script type="text/x-template" id="templateAbout">
  <div>
    <h2>これは何？</h2>
    <p>
      みんなで協力してパズドラモンスターのデータベースを作り、作成されたJSONデータを自由に使用できる形で公開しようという試みです。
    </p>
  </div>
</script>

<!-- モンスター一覧ページ -->
<script type="text/x-template" id="templateMonsterList">
  <div>
    <table class="table">
      <thead class="thead-light">
        <tr>
          <th style="text-align: right; width: 3em;">#</th>
          <th style="width: 2em;">属性</th>
          <th>名前</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="(data, key) in monsterTable">
          <td style="text-align: right;">{{key}}</td>
          <td style="width:2em;">
            <svg width="2em" height="1em">
              <circle v-if="data.attributes[0] != 0" cx="0.5em" cy="0.55em" r="0.4em" stroke="rgba(0, 0, 0, 0.5)" :fill="attrColors[data.attributes[0]]" />
              <circle v-if="data.attributes[1] != 0" cx="1.5em" cy="0.55em" r="0.4em" stroke="rgba(0, 0, 0, 0.5)" :fill="attrColors[data.attributes[1]]" />
            </svg>
          </td>
          <td><router-link :to="'/' + key">{{data.name}}</router-link></td>
        </tr>
      </tbody>
    </table>

  </div>
</script>

<!-- モンスター情報ページ -->
<script type="text/x-template" id="templateMonsterData">
  <div>
    <div class="row">
      <div class="col-12">
        <h2>No. {{monsterData.no}} {{monsterData.name}}</h2>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <img v-if="monsterData.no" :src="`./monsterImages/${monsterData.no}.jpg`" style="width: 320px; height: auto; display: block; margin: 0 auto;" onerror="var p = './monsterImages/notFound.jpg'; if (this.src!=p) { this.src = p; }" />
        <table class="table table-bordered table-sm">
          <tr class="thead-light">
            <th colspan="2">タイプ</th><th>属性</th>
          </tr>
          <tr>
            <td colspan="2"><span v-for="type in monsterData.types" v-if="type !== 0">{{typeTable[type]}} </span></td>
            <td><span v-for="attr in monsterData.attributes" v-if="attr !== 0">{{attributeTable[attr]}} </span></td>
          </tr>
          <tr class="thead-light">
            <th>コスト</th><th>レア</th><th>アシスト</th>
          </tr>
          <tr>
            <td v-if="monsterData.cost" class="text-right">{{monsterData.cost }}</td>
            <td v-else>不明</td>
            <td v-if="monsterData.rare" class="text-right">{{monsterData.rare}}</td>
            <td v-else>不明</td>
            <td>{{booleanTable[monsterData.assist]}}</td>
          </tr>
          
          <tr class="thead-light">
            <th>最大レベル</th><th>必要経験値</th><th>限界突破</th>
          </tr>
          <tr>
            <td v-if="monsterData.maxLevel" class="text-right">{{monsterData.maxLevel}}</td>
            <td v-else>不明</td>
            <td v-if="monsterData.expTable" class="text-right">{{monsterData.expTable}}</td>
            <td v-else>不明</td>
            <td>{{booleanTable[monsterData.overLimit]}}</td>
          </tr>
          <tr class="thead-light"><th colspan="3">覚醒</th></tr>
          <tr><td colspan="3">
              <span v-if="monsterData.awakens[0] === 0">なし</span>
              <span v-else-if="monsterData.awakens[0] === 99">不明</span>
              <ul v-else style="list-style: none; padding: 0px; display: flex;">
              <li v-for="awaken in monsterData.awakens" v-if="awaken !== 0" style="width: 11.11%; text-align: center;"><img :src="'./kakusei/' + awaken + '.png'" width="24" height="24" :title="awakenTable[awaken]"></li>
            </ul>
          </td></tr>
        </table>
      </div>
      <div class="col-md-6">
        <table v-if="monsterData.maxParam.hp != undefined || monsterData.maxParam.attack != undefined || monsterData.maxParam.recovery != undefined" class="table table-bordered table-sm">
          <tr class="thead-light"><th colspan="2">レベル{{monsterData.maxLevel}}（最大）時</th><th>+297</th></tr></td>
          <tr><th style="width:auto;">HP</th><td style="width: 35%;" class="text-right">{{monsterData.maxParam.hp}}</td><td style="width:35%;" class="text-right">{{monsterData.maxParam.hp + 10 * 99}}</td></tr>
          <tr><th>攻撃</th><td class="text-right">{{monsterData.maxParam.attack}}</td><td class="text-right">{{monsterData.maxParam.attack + 5 * 99}}</td></tr>
          <tr><th>回復</th><td class="text-right">{{monsterData.maxParam.recovery}}</td><td class="text-right">{{monsterData.maxParam.recovery + 3 * 99}}</td></tr>
          <tr v-if="monsterData.overLimit == 1" class="thead-light"><th colspan="2">レベル110（限界突破）時</th><th>+297</th></tr></td>
          <tr v-if="monsterData.overLimit == 1"><th>HP</th><td class="text-right">{{monsterData.overLimitParam.hp}}</td><td class="text-right">{{monsterData.overLimitParam.hp + 10 * 99}}</td></tr>
          <tr v-if="monsterData.overLimit == 1"><th>攻撃</th><td class="text-right">{{monsterData.overLimitParam.attack}}</td><td class="text-right">{{monsterData.overLimitParam.attack + 5 * 99}}</td></tr>
          <tr v-if="monsterData.overLimit == 1"><th>回復</th><td class="text-right">{{monsterData.overLimitParam.recovery}}</td><td class="text-right">{{monsterData.overLimitParam.recovery + 3 * 99}}</td></tr>
        </table>
        <table v-else class="table table-bordered table-sm">
          <tr class="thead-light"><th>最大パラメータ不明</th></tr>
        </table>

        <table class="table table-bordered table-sm">
            <tr class="thead-light"><th>スキル</th></tr>
            <tr><td>
              {{skillDetails.name}}
              <span v-if="skillDetails.baseTurn >= 1" style="font-size: 80%; float:right;">(Lv.1 ターン:{{skillDetails.baseTurn}} 最大Lv.<span v-if="skillDetails.maxLevel">{{skillDetails.maxLevel}} ターン:{{skillDetails.baseTurn - skillDetails.maxLevel + 1}}</span><span v-else>不明</span>)</span>
            </td></tr>
            <tr><td style="font-size: 90%; padding-left: 1em; white-space: pre;">{{skillDetails.description}}</td></tr>
  
            <tr class="thead-light"><th>リーダースキル</th></tr>
            <tr><td>
              {{leaderSkillDetails.name}}
            </td></tr>
            <tr><td style="font-size: 90%; padding-left: 1em; white-space: pre;">{{leaderSkillDetails.description}}</td></tr>
          </table> 
      </div>
    </div>

    <div class="row" v-if="monsterData.overLimit == 1 && monsterData.superAwakens.length">
      <div class="col-12">
        <table class="table table-bordered table-sm">
          <tr class="thead-light"><th>超覚醒</th></tr>
          <tr><td>
              <ul>
                <li v-for="superAwaken in monsterData.superAwakens"><img :src="'./kakusei/' + superAwaken + '.png'" width="24" height="24" :title="awakenTable[superAwaken]">{{awakenTable[superAwaken]}}</li>
              </ul>
          </td></tr>
        </table>
      </div>
    </div>
    <div v-if="monsterData.evolutionType !== 0">
      <table class="table table-bordered table-sm">
        <tr class="thead-light"><th>このモンスターへの進化形式</th></tr>
        <tr><td>{{evolutionTypeTable[monsterData.evolutionType]}}</td></tr>
        <template v-if="monsterData.evolutionType !== 99">
        <tr class="thead-light"><th>進化前モンスター</th></tr>
        <tr><td>
          <router-link v-if="monsterData.evolution.baseNo" :to="`/${monsterData.evolution.baseNo}`">No. {{monsterData.evolution.baseNo}} {{monsterTable[monsterData.evolution.baseNo] && monsterTable[monsterData.evolution.baseNo].name}}</router-link>
          <span v-else>不明</span>
        </td></tr>
        <tr class="thead-light"><th>進化素材</th></tr>
        <tr><td>
          <ul v-if="monsterData.evolution.materials[0]" style="width: 100%; list-style: none; padding: 0px; display:flex; justify-content: space-around;">
            <li v-for="material in monsterData.evolution.materials" v-if="material !== 0" style="flex: 1;"><router-link :to="`/${material}`">No. {{material}} {{monsterTable[material] && monsterTable[material].name}}</router-link></li>
          </ul>
          <span v-else>不明</span>
        </td></tr>
        </template>
      </table>
    </div>
    <div v-if="monsterData.comment">
      <table class="table table-bordered table-sm">
        <tr class="thead-light"><th>編集コメント</th></tr>
        <tr><td>{{monsterData.comment}}</td></tr>
      </table>
    </div>
    <router-link :to="'/edit/' + $route.params.no">編集する</router-link>
    <router-link :to="'/pic/' + $route.params.no">モンスター画像投稿</router-link>
  </div>

</script>

<!-- モンスター情報編集ページ -->
<script type="text/x-template" id="templateMonsterEdit">
  <div>
    <form onsubmit="return false;" @submit="submit">
      <table class="table table-bordered table-sm">
        <tr>
          <td colspan="12">
              <div class="form-row">
            <div class="col-md-4">
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">No.</span>
                </div>
                <input type="number" class="form-control" id="inputNo" v-model="monsterData.no" required min="1" max="9999">
              </div>
            </div>
            <div class="form-group col-md-8">
              <input type="text" class="form-control" id="inputMonsterName" placeholder="モンスター名" v-model="monsterData.name" required minLength="1" maxLength="50">
            </div>
            <div>
          </td>
        </tr>
        <tr class="thead-light"><th colspan="12">タイプ</th></tr>
        <tr>
          <td v-for="n in 3" colspan="4">
            <select class="custom-select" :id="'selectType' + n" v-model="monsterData.types[n - 1]">
              <option v-for="(type, key) in typeTable" :value="key" :key="key" v-once>{{type}}</option>
            </select>
          </td>
        </tr>
        <tr class="thead-light">
          <th colspan="3">属性</th>
          <th colspan="3">複属性</th>
          <th colspan="3">コスト</th>
          <th colspan="3">レア</th>
        </tr>
        <tr>
            <td colspan="3">
                <select class="custom-select" id="selectType1" v-model="monsterData.attributes[0]">
                  <option v-for="(attribute, key) in attributeTable" :value="key" :key="key" v-once>{{attribute}}</option>
                </select></td>
            <td colspan="3">
                <select class="custom-select" id="selectType2" v-model="monsterData.attributes[1]">
                  <option v-for="(attribute, key) in attributeTable" :value="key" :key="key" v-once>{{attribute}}</option>
                </select></td>
            <td colspan="3">
              <input type="number" class="form-control" id="inputNo" v-model="monsterData.cost" min="1" max="999">
            </td>
            <td colspan="3">
              <input type="number" class="form-control" id="inputNo" v-model="monsterData.rare" min="1" max="99">
            </td>
        </tr>
        <tr class="thead-light">
          <th colspan="4">最大レベル</th>
          <th colspan="4">最大レベルに必要な経験値</th>
          <th colspan="4">アシスト</th>
        </tr>
        <tr>
          <td colspan="4">
            <input type="number" class="form-control" id="inputNo" v-model="monsterData.maxLevel" min="1" max="99">
          </td>
          <td colspan="4">
            <input type="number" class="form-control" id="inputNo" v-model="monsterData.expTable" min="0" max="999999999">
          </td>
          <td colspan="4">
            <select class="custom-select" id="selectAssist" v-model="monsterData.assist">
              <option v-for="(type, key) in booleanTable" :value="key" :key="key" v-once>{{type}}</option>
            </select>
          </td>
        </tr>
        <tr class="thead-light">
          <th colspan="12">覚醒</th>
        </tr>
        <tr v-for="n in 9" :key="n">
          <td colspan="12">
            <pd-select v-model="monsterData.awakens[n - 1]">
              <pd-option v-for="(awaken, key) in awakenTable" :value="key" :key="key" v-once><img :src="(key == 0 || key == 99) ? '' : `./kakusei/${key}.png`" width="24" height="24" /> {{awaken}}</pd-option>
            </pd-select>
          </td>
        </tr>
        <tr class="thead-light">
          <th colspan="12">レベル最大時パラメータ</th>
        </tr>
        <tr>
          <th colspan="4">HP</th>
          <td colspan="8">
            <input type="number" class="form-control" id="inputNo" v-model="monsterData.maxParam.hp" min="1" max="99999">
          </td>
        </tr>
        <tr>
          <th colspan="4">攻撃</th>
          <td colspan="8">
            <input type="number" class="form-control" id="inputNo" v-model="monsterData.maxParam.attack" min="1" max="99999">
          </td>
        </tr>
        <tr>
          <th colspan="4">回復</th>
          <td colspan="8">
            <input type="number" class="form-control" id="inputNo" v-model="monsterData.maxParam.recovery" min="-9999" max="99999">
          </td>
        </tr>
        <tr class="thead-light">
          <th colspan="12">スキル</th>
        </tr>
        <tr>
          <th colspan="8">名称</th>
          <th colspan="2">SLv1時ターン</th>
          <th colspan="2">最大SLv</th>
        </tr>
        <tr>
          <td colspan="8">
            <skill-incremental-input placeholder="スキル名" @select-no="monsterData.skill = $event;" v-model="skillDetails.name" :skill-table="skillTable"></skill-incremental-input>
          </td>
          <td colspan="2">
            <input type="number" class="form-control" id="inputSkillTurn" v-model="skillDetails.baseTurn" min="1" max="199">
          </td>
          <td colspan="2">
            <input type="number" class="form-control" id="inputSkillTurn" v-model="skillDetails.maxLevel" min="1" max="99">
          </td>
        </tr>
        <tr>
          <th colspan="12">説明</th>
        </tr>
        <tr>
          <td colspan="12">
            <textarea class="form-control" id="exampleFormControlTextarea1" rows="2" v-model="skillDetails.description" required minLength="1" maxLength="200"></textarea>
          </td>
        </tr>
        <tr class="thead-light">
          <th colspan="12">リーダースキル</th>
        </tr>
        <tr>
          <th colspan="12">名称</th>
        </tr>
        <tr>
          <td colspan="12">
            <skill-incremental-input placeholder="リーダースキル名" @select-no="monsterData.leaderSkill = $event;" v-model="leaderSkillDetails.name" :skill-table="leaderSkillTable"></skill-incremental-input>
          </td>
        </tr>
        <tr class="">
          <th colspan="12">説明</th>
        </tr>
        <tr>
          <td colspan="12">
            <textarea class="form-control" id="exampleFormControlTextarea1" rows="2" v-model="leaderSkillDetails.description" required minLength="1" maxLength="200"></textarea>
          </td>
        </tr>
        <tr class="thead-light">
          <th colspan="12">限界突破</th>
        </tr>
        <tr>
          <td colspan="12">
            <select class="custom-select" id="selectOverLimit" v-model="monsterData.overLimit">
              <option v-for="(type, key) in booleanTable" :value="key" :key="key" v-once>{{type}}</option>
            </select>
          </td>
        </tr>
        <template v-if="monsterData.overLimit == 1">
          <tr class="thead-light">
            <th colspan="12">限界突破時パラメータ</th>
          </tr>
          <tr>
            <th colspan="4">HP</th>
            <td colspan="8">
              <input type="number" class="form-control" id="inputNo" v-model="monsterData.overLimitParam.hp" min="1" max="99999">
            </td>
          </tr>
          <tr>
            <th colspan="4">攻撃</th>
            <td colspan="8">
              <input type="number" class="form-control" id="inputNo" v-model="monsterData.overLimitParam.attack" min="1" max="99999">
            </td>
          </tr>
          <tr>
            <th colspan="4">回復</th>
            <td colspan="8">
              <input type="number" class="form-control" id="inputNo" v-model="monsterData.overLimitParam.recovery" min="-9999" max="99999">
            </td>
          </tr>
          <tr class="thead-light">
            <th colspan="12">超覚醒</th>
          </tr>
          <tr>
            <td colspan="12">
              <span v-for="(awaken, key) in awakenTable" v-if="key != 0" class="col-md-3 form-check" style="display:inline-block;" :key="key">
                <input class="form-check-input" type="checkbox" :value="key" v-model="monsterData.superAwakens" :id="'superAwaken' + key">
                <label class="form-check-label" :for="'superAwaken' + key">
                  <img v-if="key != 99" :src="'./kakusei/' + key + '.png'" width="24" height="24" />{{awaken}}
                </label>
              </span>
            </td>
          </tr>
        </template>
        <tr class="thead-light">
          <th colspan="12">進化形式</th>
        </tr>
        <tr>
          <td colspan="12"> 
            <select class="custom-select" id="evolutionType" v-model="monsterData.evolutionType">
              <option v-for="(type, key) in evolutionTypeTable" :value="key" :key="key" v-once>{{type}}</option>
            </select>
          </td>
        </tr>
        <template v-if="monsterData.evolutionType != 0 && monsterData.evolutionType != 99">
          <tr class="thead-light">
            <th colspan="12">進化前キャラ</th>
          </tr>
          <tr>
            <td colspan="12">
              <monster-incremental-search v-model="monsterData.evolution.baseNo" :monster-table="monsterTable"></monster-incremental-search>
            </td>
          </tr>
          <tr class="thead-light">
            <th colspan="12">素材</th>
          </tr>
          <tr v-for="n in 5">
            <td colspan="12">
              <monster-incremental-search v-model="monsterData.evolution.materials[n - 1]" :monster-table="monsterTable" :key="n"></monster-incremental-search>
            </td>
          </tr>
        </template>
        <tr class="thead-light">
          <th colspan="12">編集コメント（任意）</th>
        </tr>
        <tr>
          <td colspan="12">
            編集理由などを書いてください。（例：パラメータの更新）
            <textarea class="form-control" id="commentTextarea" rows="3" v-model="monsterData.comment" minLength="0" maxLength="1000"></textarea>
          </td>
        </tr>
        <tr>
          <td v-for="n in 12" style="width:8.33333%; padding: 0; border: none;"></td>
        </tr>    
      </table>  
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
  </div>
</script>

<!-- 画像投稿ページ -->
<script type="text/x-template" id="templatePic">
  <div class="row">
    <div class="col-md-6">
      <canvas id="canvas" style="display:none;"></canvas>
      <div class="col-md-12">
        <template v-if="!this.$route.params.no">モンスター番号と</template>
        <template v-else>No.{{this.monsterNo}} {{(monsterTable[monsterNo] || {}).name || 'のモンスター'}}の</template>
        モンスター情報画面の画像ファイルを選択してください。</div>
      <div class="row">
          <div v-if="!this.$route.params.no" class="col-md-12">
            <monster-incremental-search v-model="monsterNo" :monster-table="monsterTable"></monster-incremental-search>
          </div>
        <div class="col-md-12">
          <div class="custom-file">
            <input type="file" class="custom-file-input" id="monsterImageFile" @change="loadLocalImage">
            <label class="custom-file-label" for="monsterImageFile">モンスター情報画像選択</label>
          </div>
        </div>
      
      </div>
      <img :src="uploadImgSrc" style="width: 100%; height: auto;" />
    </div>
    <div v-if="imageResultSrc" id="result" class="col-md-6">
      <h2>切り抜き結果</h2>
      <div>
        <h3>モンスター画像</h3>
        <img :src="imageResultSrc" style="width: 100%;"/>
      </div>
      <div>
        <h3>アイコン画像</h3>
        <img :src="iconResultSrc" />
      </div>
          
      </table>
      <button @click="submit" class="btn btn-primary">この画像を送信する</button>
    </div>
  </div>
</script>


<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.2.1/vue.js"></script>
<script src="https://unpkg.com/vue-router@3.0.1/dist/vue-router.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://unpkg.com/vuex@3.0.1/dist/vuex.js"></script>

<script src="./script.js"></script>

</body>
</html>